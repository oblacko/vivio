# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã —à–µ—Ä–∏–Ω–≥–∞

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev --name add_video_sharing_analytics

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npx prisma generate
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –≤ `prisma/migrations/`
- –û–±–Ω–æ–≤–ª–µ–Ω Prisma Client
- –í –ë–î –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `shareCount`, `referrerData` –≤ —Ç–∞–±–ª–∏—Ü—É `videos`
- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `video_shares`

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` –∏–ª–∏ `.env.local`:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö Open Graph URL
NEXT_PUBLIC_APP_URL=http://localhost:3001

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
# NEXT_PUBLIC_APP_URL=https://your-domain.com
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm run dev
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ Prisma Studio
npx prisma studio

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
# - –¢–∞–±–ª–∏—Ü–∞ video_shares —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
# - –í —Ç–∞–±–ª–∏—Ü–µ videos –µ—Å—Ç—å –ø–æ–ª—è shareCount, referrerData
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–µ –≤–∏–¥–µ–æ**
   - URL: `http://localhost:3001/videos/{videoId}`
   - –ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ShareDialog**
   - –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ `/v/{videoId}`
   - –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É"

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É**
   - –ù–∞–∂–º–∏—Ç–µ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"
   - –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"
   - –í—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ `/v/{videoId}`
   - –î–æ–ª–∂–µ–Ω –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/videos/{videoId}`
   - –í Prisma Studio –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `video_shares`

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—á–µ—Ç—á–∏–∫**
   - –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∏–¥–µ–æ –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—á–µ—Ç—á–∏–∫ —à–µ—Ä–∏–Ω–≥–æ–≤
   - –ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Open Graph –º–µ—Ç–∞—Ç–µ–≥–æ–≤

#### –õ–æ–∫–∞–ª—å–Ω–æ (—Å ngrok)

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
ngrok http 3001

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

#### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä HTML**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `view-source:http://localhost:3001/v/{videoId}`
   - –ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–∞—Ç–µ–≥–∏ `<meta property="og:..."`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ:
     - `og:title`
     - `og:description`
     - `og:image`
     - `og:video`
     - `twitter:card`

2. **Facebook Debugger** (—Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL)
   - https://developers.facebook.com/tools/debug/
   - –í—Å—Ç–∞–≤—å—Ç–µ ngrok –∏–ª–∏ production URL
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–≤—å—é

3. **Twitter Card Validator** (—Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL)
   - https://cards-dev.twitter.com/validator

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Vercel

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–∞—Ç–µ–≥–æ–≤**
   ```
   Facebook Debugger: https://your-domain.com/v/{videoId}
   ```

2. **–†–µ–∞–ª—å–Ω—ã–π —à–µ—Ä–∏–Ω–≥**
   - –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤ VK
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ Telegram
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–≤—å—é

3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Prisma Studio (prod –ë–î)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ `video_shares`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç `shareCount`

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `relation "video_shares" already exists`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx prisma db pull
npx prisma generate
```

### ‚ùå TypeScript –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `Property 'shareCount' does not exist on type 'Video'`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx prisma generate
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ TypeScript —Å–µ—Ä–≤–µ—Ä –≤ IDE
```

### ‚ùå –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/v/{id}` –Ω–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `src/app/v/[id]/page.tsx` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–µ–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î

### ‚ùå Open Graph –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ—Ü—Å–µ—Ç—å –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `NEXT_PUBLIC_APP_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok)
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à —Å–æ—Ü—Å–µ—Ç–∏ (Facebook Debugger ‚Üí Scrape Again)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–µ–æ `isPublic: true`

### ‚ùå Web Share API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- Web Share API —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ HTTPS (–∏–ª–∏ localhost)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–µ—Å–∫—Ç–æ–ø –±—Ä–∞—É–∑–µ—Ä—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç Web Share API

### ‚ùå –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `video_shares` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/api/videos/{id}/share`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —à–µ—Ä–∏–Ω–≥–∞–º

–í `src/app/api/videos/route.ts` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É:

```typescript
if (sortBy === "shared") {
  orderBy = { shareCount: "desc" };
}
```

### –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```typescript
// src/app/admin/analytics/page.tsx
const analytics = await prisma.videoShare.groupBy({
  by: ['source'],
  _count: { id: true },
});
```

### Rate Limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å—Ç–µ –ª–∏–º–∏—Ç –Ω–∞ –∑–∞–ø–∏—Å—å —à–µ—Ä–∏–Ω–≥–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–ø–∞–º–∞:

```typescript
// –í API route
const recentShares = await prisma.videoShare.count({
  where: {
    videoId: id,
    createdAt: {
      gte: new Date(Date.now() - 60000) // 1 –º–∏–Ω—É—Ç–∞
    }
  }
});

if (recentShares > 10) {
  return NextResponse.json({ error: "Too many shares" }, { status: 429 });
}
```

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ —à–µ—Ä–∏–Ω–≥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ:

‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ `/v/{id}` –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞
‚úÖ Open Graph –º–µ—Ç–∞—Ç–µ–≥–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –ø—Ä–µ–≤—å—é
‚úÖ Web Share API –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚úÖ –°—á–µ—Ç—á–∏–∫ —à–µ—Ä–∏–Ω–≥–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∏–¥–µ–æ
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è OG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
2. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É —à–µ—Ä–∏–Ω–≥–æ–≤
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [SHARING_GUIDE.md](./SHARING_GUIDE.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [MIGRATION_STEPS.md](./MIGRATION_STEPS.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [IMPLEMENTATION_SUMMARY_SHARING.md](./IMPLEMENTATION_SUMMARY_SHARING.md) - –†–µ–∑—é–º–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
