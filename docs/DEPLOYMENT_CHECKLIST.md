# Чеклист деплоя - Vivio v2.0.0

## Pre-deployment

### 1. Код и зависимости
- [ ] Все изменения закоммичены в Git
- [ ] Нет ошибок TypeScript (`npm run build`)
- [ ] Нет ошибок линтера (`npm run lint`)
- [ ] Все тесты проходят (`npm run test:run`)
- [ ] package.json обновлен с новыми зависимостями

### 2. База данных
- [ ] Prisma schema обновлена (`prisma/schema.prisma`)
- [ ] Миграция создана (`npx prisma migrate dev`)
- [ ] Миграция протестирована локально
- [ ] Seed данные обновлены (если необходимо)

### 3. Переменные окружения
Проверьте наличие всех переменных в Vercel Dashboard:

- [ ] `POSTGRES_URL` - Production database URL
- [ ] `POSTGRES_PRISMA_URL` - Prisma connection string
- [ ] `BLOB_READ_WRITE_TOKEN` - Vercel Blob для аватаров
- [ ] `AUTH_SECRET` - NextAuth secret
- [ ] `AUTH_GOOGLE_ID` - Google OAuth Client ID
- [ ] `AUTH_GOOGLE_SECRET` - Google OAuth Secret
- [ ] `GROK_API_KEY` - Grok AI API key
- [ ] `GROK_API_URL` - Grok API URL
- [ ] `UPSTASH_REDIS_REST_URL` - Redis URL
- [ ] `UPSTASH_REDIS_REST_TOKEN` - Redis token

## Deployment

### 1. Push в GitHub
```bash
git add .
git commit -m "feat: add admin panel, profiles, and UI improvements"
git push origin main
```

### 2. Применение миграции БД
После деплоя в Vercel:

1. Откройте терминал в Vercel Dashboard
2. Выполните:
```bash
npx prisma migrate deploy
```

### 3. Создание первого администратора

Выберите один из способов:

**A. Через Prisma Studio (локально):**
```bash
npx prisma studio --browser none
```
Затем обновите роль пользователя на ADMIN

**B. Через SQL (в Vercel Postgres):**
```sql
UPDATE users 
SET role = 'ADMIN' 
WHERE email = 'your-email@example.com';
```

**C. Через скрипт:**
Создайте `scripts/set-admin.ts` и выполните на сервере

## Post-deployment

### 1. Проверка функциональности

#### Базовые функции:
- [ ] Главная страница загружается
- [ ] Отображаются публичные видео
- [ ] Работают фильтры по категориям
- [ ] Hero секция корректно отображается

#### Аутентификация:
- [ ] Регистрация работает
- [ ] Вход через email/password работает
- [ ] Вход через Google OAuth работает
- [ ] Выход из системы работает

#### Профили:
- [ ] Просмотр публичного профиля работает
- [ ] Редактирование собственного профиля работает
- [ ] Загрузка аватара работает
- [ ] Сохранение bio работает
- [ ] Добавление социальных сетей работает
- [ ] Переключение публичности профиля работает

#### Защита контента:
- [ ] Неавторизованные пользователи не могут создавать видео
- [ ] FloatingUploadButton показывает диалог входа для гостей
- [ ] Страница `/create` требует авторизацию

#### Админ-панель:
- [ ] Страница `/admin` доступна только администраторам
- [ ] Создание челленджа работает
- [ ] Редактирование челленджа работает
- [ ] Деактивация челленджа работает
- [ ] Обычные пользователи не имеют доступа

#### Навигация:
- [ ] Dropdown меню пользователя работает
- [ ] Ссылка на профиль работает
- [ ] Ссылка на админ-панель (для админов) работает
- [ ] Мобильная навигация работает

### 2. Проверка UI/UX

- [ ] Hero секция корректно отображается
- [ ] Фильтры категорий работают
- [ ] Hover эффекты на карточках работают
- [ ] Анимации плавные
- [ ] Темная тема работает корректно
- [ ] Мобильная версия адаптивна
- [ ] Загрузочные скелетоны показываются

### 3. Проверка производительности

- [ ] Lighthouse Score > 90 (Performance)
- [ ] Lighthouse Score > 90 (Accessibility)
- [ ] Lighthouse Score > 90 (Best Practices)
- [ ] Lighthouse Score > 90 (SEO)
- [ ] Время загрузки главной < 2 сек
- [ ] Core Web Vitals в норме

### 4. Мониторинг

После деплоя следите за:
- [ ] Ошибки в Vercel Logs
- [ ] Ошибки в Vercel Analytics
- [ ] Метрики производительности
- [ ] Использование базы данных
- [ ] Использование Blob Storage

## Rollback план

Если что-то пошло не так:

### 1. Откат кода:
```bash
git revert HEAD
git push origin main
```

### 2. Откат миграции БД:
⚠️ **Используйте осторожно!**

```bash
# Получить список миграций
npx prisma migrate status

# Откатить последнюю миграцию (только если она еще не применялась к production!)
npx prisma migrate reset
```

### 3. Переключение на предыдущий деплой:
В Vercel Dashboard → Deployments → выберите предыдущий деплой → Promote to Production

## Дополнительные задачи

### Опционально:
- [ ] Обновить документацию API
- [ ] Обновить README.md
- [ ] Создать changelog
- [ ] Уведомить пользователей о новых функциях
- [ ] Обновить обучающие материалы

### Мониторинг первых 24 часов:
- [ ] Проверить логи ошибок через 1 час
- [ ] Проверить аналитику через 6 часов
- [ ] Проверить отзывы пользователей через 12 часов
- [ ] Полная проверка через 24 часа

## Команда поддержки

При возникновении проблем:
1. Проверьте Vercel Logs
2. Проверьте Vercel Analytics
3. Проверьте статус базы данных (Vercel Postgres)
4. Проверьте статус Redis (Upstash)
5. Проверьте статус Blob Storage (Vercel Blob)

---

**Дата:** 2026-01-17
**Версия:** v2.0.0
**Автор:** Vivio Dev Team
