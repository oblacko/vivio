# Документация компонентов Vivio

## Описание проекта
Vivio — платформа для создания видео из изображений с помощью искусственного интеллекта. Пользователи могут загружать фотографии, кадрировать их и генерировать анимированные видео.

---

## 1. Навигация и структура

### 1.1 Navigation (`components/navigation.tsx`)
**Назначение:** Главная навигационная панель приложения

**Функционал:**
- Отображает логотип и название приложения (vibeo.fun)
- Навигационные ссылки: Главная, Тренды, Видео, Создать видео
- Адаптивное меню для мобильных устройств (Sheet)
- Авторизация пользователя:
  - Для авторизованных: аватар с выпадающим меню (профиль, админ-панель, выход)
  - Для неавторизованных: кнопка "Войти"
- Интеграция с контекстом загрузки для открытия модального окна создания видео
- Подсветка активной страницы
- Sticky позиционирование с эффектом blur

**Технические детали:**
- Использует `usePathname` для определения активной страницы
- Интеграция с `useAuth` для проверки авторизации
- DropdownMenu для меню пользователя
- Sheet для мобильного меню

---

## 2. Компоненты авторизации

### 2.1 LoginForm (`components/login-form.tsx`)
**Назначение:** Форма входа в систему

**Функционал:**
- Поля ввода: Email, Пароль
- Валидация формы
- Вход через Google OAuth
- Обработка ошибок с отображением сообщений
- Редирект после успешного входа (поддержка callbackUrl)
- Ссылка на регистрацию
- Состояния загрузки (isLoading)

**UI элементы:**
- Card с двухколоночной сеткой (форма + информационный блок)
- Иконка видео в правой колонке
- Согласие с условиями использования

### 2.2 SignupForm (`components/signup-form.tsx`)
**Назначение:** Форма регистрации нового пользователя

**Функционал:**
- Поля ввода: Имя, Email, Пароль, Подтверждение пароля
- Валидация (минимальная длина пароля 6 символов)
- Регистрация через Google OAuth
- Обработка ошибок
- Редирект после успешной регистрации
- Ссылка на страницу входа

**UI элементы:**
- Аналогичная структура с LoginForm
- Дополнительные поля для регистрации

### 2.3 PopularVideoShowcase (`components/auth/PopularVideoShowcase.tsx`)
**Назначение:** Показ популярного видео на страницах авторизации

**Функционал:**
- Загрузка топ-10 популярных видео
- Случайный выбор видео из списка
- Автовоспроизведение при наведении
- Отображение превью с иконкой Play
- Показ статистики (лайки, просмотры)
- Информация о челлендже и авторе

**UI элементы:**
- Вертикальный видео плеер (9:16)
- Overlay с информацией при наведении
- Бейдж "Живой пример"
- Skeleton loader при загрузке

---

## 3. Компоненты видео

### 3.1 VideoCard (`components/video/VideoCard.tsx`)
**Назначение:** Карточка для отображения видео в списках

**Функционал:**
- Отображение превью (thumbnail) или первого кадра видео
- Автогенерация превью из первого кадра, если нет thumbnail
- Автовоспроизведение при наведении (опционально)
- Поддержка вертикального (9:16) и квадратного (1:1) форматов
- Переход на страницу видео по клику
- Анимации при наведении (framer-motion)
- Overlay с иконкой Play

**Параметры:**
- `videoUrl` — URL видео файла
- `thumbnailUrl` — URL превью (опционально)
- `aspectRatio` — формат отображения
- `href` — ссылка на страницу видео
- `showControls` — показывать ли элементы управления
- `autoPlayOnHover` — автовоспроизведение при наведении

### 3.2 VideoPlayer (`components/video/VideoPlayer.tsx`)
**Назначение:** Видео плеер с элементами управления

**Функционал:**
- Воспроизведение видео
- Элементы управления:
  - Play/Pause
  - Mute/Unmute
  - Полноэкранный режим
- Автовоспроизведение (опционально)
- Зацикливание (loop)
- Беззвучный режим по умолчанию
- Показ элементов управления при наведении
- Поддержка вертикального и квадратного форматов
- Watermark "Vivio"

**Технические детали:**
- Использует нативный HTML5 video элемент
- Управление через ref
- Анимации появления элементов управления

---

## 4. Компоненты загрузки и генерации

### 4.1 ImageToVideoUploader (`components/upload/ImageToVideoUploader.tsx`)
**Назначение:** Компонент для загрузки изображения и генерации видео

**Функционал:**
- Загрузка изображения через drag & drop или выбор файла
- Поддержка форматов: PNG, JPG, JPEG, WEBP (макс. 10MB)
- Превью загруженного изображения
- Загрузка на сервер
- Инициация генерации видео через API
- Отслеживание прогресса генерации
- Отображение статусов: idle, uploading, file-uploaded, processing, completed, error
- Скачивание готового видео
- Переход на страницу просмотра видео
- Повторная попытка при ошибке

**Состояния:**
1. **idle** — ожидание загрузки файла
2. **uploading** — загрузка на сервер (50% прогресса)
3. **file-uploaded** — файл загружен, ожидание запуска генерации
4. **processing** — генерация видео (отслеживание прогресса)
5. **completed** — видео готово
6. **error** — ошибка обработки

**Интеграции:**
- `useUploadImage` — загрузка изображения
- `useInitiateGeneration` — запуск генерации
- `useGenerationStatus` — отслеживание статуса
- `useGenerationStore` — глобальное состояние генерации

### 4.2 FileUpload (`components/upload/FileUpload.tsx`)
**Назначение:** Многошаговый компонент загрузки с кадрированием

**Функционал:**
- **Шаг 1:** Загрузка файла (drag & drop или выбор)
- **Шаг 2:** Кадрирование изображения:
  - Выбор формата кадрирования (Instagram Post, Story, Facebook Cover, Twitter Post, Свободное)
  - Управление масштабом (zoom)
  - Интерактивное кадрирование через react-easy-crop
- **Шаг 3:** Обработка и генерация:
  - Загрузка кадрированного изображения
  - Выбор челленджа (опционально)
  - Запуск генерации видео
  - Отслеживание прогресса
  - Скачивание готового видео
  - Поделиться ссылкой

**Особенности:**
- Блокировка загрузки во время генерации
- Валидация формата файла
- Обработка ошибок на каждом этапе
- Toast уведомления

### 4.3 UploadSheet (`components/upload/UploadSheet.tsx`)
**Назначение:** Модальное окно для загрузки изображения с кадрированием

**Функционал:**
- Открывается в Sheet (нижняя панель)
- Загрузка файла
- Кадрирование с фиксированным соотношением 9:16
- Загрузка на сервер
- Callback при завершении загрузки

### 4.4 FloatingUploadButton (`components/upload/FloatingUploadButton.tsx`)
**Назначение:** Плавающая кнопка для быстрого доступа к загрузке

**Функционал:**
- Фиксированная позиция в правом нижнем углу
- Открывает Sheet с компонентом FileUpload
- Видна только авторизованным пользователям
- Скрывается когда Sheet открыт
- Интеграция с upload-context

**UI элементы:**
- Круглая кнопка с иконкой Plus
- Тень и эффекты наведения
- GridPattern фон в Sheet

### 4.5 GenerationProgress (`components/generation/GenerationProgress.tsx`)
**Назначение:** Компонент отображения прогресса генерации видео

**Функционал:**
- Круговой индикатор прогресса
- Текстовое описание текущего этапа:
  - "В очереди..."
  - "Обработка изображения..." (0-30%)
  - "Генерация движения..." (30-70%)
  - "Финализация..." (70-100%)
  - "Готово!"
  - "Ошибка генерации"
- Линейный прогресс-бар
- Иконки статуса (Loader, CheckCircle, XCircle)
- Callback при завершении/ошибке

**Анимации:**
- Плавное изменение прогресса
- Анимация иконок статуса
- Framer Motion для переходов

---

## 5. Компоненты челленджей

### 5.1 ChallengeCard (`components/challenges/ChallengeCard.tsx`)
**Назначение:** Карточка челленджа для отображения в списках

**Функционал:**
- Отображение превью челленджа (thumbnail)
- Название и описание
- Статистика:
  - Количество участников
  - Количество лайков
  - Количество просмотров
- Бейдж с длительностью видео ("6 сек")
- Аватар автора челленджа
- Категория челленджа
- Кнопки действий:
  - Лайк (с визуальной обратной связью)
  - Поделиться
- Переход на страницу челленджа по клику

**UI элементы:**
- Card с вертикальным форматом (9:16)
- Overlay с градиентом для статистики
- Анимации при наведении (framer-motion)
- Badge для категории и длительности

---

## 6. Компоненты шаринга

### 6.1 ShareDialog (`components/share/ShareDialog.tsx`)
**Назначение:** Диалог для поделиться видео в социальных сетях

**Функционал:**
- Генерация короткой ссылки (`/v/{videoId}`)
- Поделиться в социальных сетях:
  - VK
  - Telegram
  - Twitter
  - Facebook
- Web Share API для мобильных устройств
- Копирование ссылки в буфер обмена
- Отслеживание источника шаринга (аналитика)
- Запись метаданных (referrer, userAgent)

**UI элементы:**
- Dialog с сеткой кнопок социальных сетей
- Иконки для каждой платформы
- Цветовая индикация при наведении
- Отображение короткой ссылки
- Кнопка копирования с подтверждением

---

## 7. Компоненты админ-панели

### 7.1 AppSidebar (`components/admin/AppSidebar.tsx`)
**Назначение:** Боковая панель навигации в админ-панели

**Функционал:**
- Навигация по разделам:
  - Челленджи
  - Пользователи
  - Настройки
- Подсветка активного раздела
- Сворачивание в иконки (collapsible)
- Информация о текущем администраторе в footer
- Аватар администратора

**UI элементы:**
- Sidebar компонент из shadcn/ui
- Иконки для каждого раздела
- Tooltip при свернутом состоянии

### 7.2 UsersTable (`components/admin/UsersTable.tsx`)
**Назначение:** Таблица пользователей с управлением

**Функционал:**
- Отображение списка пользователей:
  - Имя
  - Email
  - Роль (USER/ADMIN) с Badge
  - Баланс кредитов
  - Количество видео
  - Количество генераций
- Действия:
  - Редактирование баланса (открывает EditBalanceDialog)
  - Просмотр истории транзакций (открывает TransactionsModal)
- Обновление данных после изменений

**UI элементы:**
- Table компонент из shadcn/ui
- Badge для ролей
- Кнопки действий с иконками

### 7.3 SettingsForm (`components/admin/SettingsForm.tsx`)
**Назначение:** Форма настроек приложения

**Функционал:**
- Управление стоимостью генерации видео (в кредитах)
- Загрузка текущих настроек
- Сохранение изменений
- Валидация формы (положительное число)
- Toast уведомления об успехе/ошибке

**UI элементы:**
- Card с формой
- Input для числового значения
- Описание поля
- Кнопка сохранения с состоянием загрузки

### 7.4 EditBalanceDialog (`components/admin/EditBalanceDialog.tsx`)
**Назначение:** Диалог редактирования баланса пользователя

**Функционал:**
- Выбор типа операции:
  - Зачисление (CREDIT)
  - Списание (DEBIT)
- Ввод суммы
- Описание операции (опционально)
- Валидация (положительная сумма)
- Сохранение изменений
- Callback при успехе

**UI элементы:**
- Dialog компонент
- Select для типа операции
- Input для суммы
- Textarea для описания
- Кнопки Отмена/Сохранить

### 7.5 TransactionsModal (`components/admin/TransactionsModal.tsx`)
**Назначение:** Модальное окно истории транзакций пользователя

**Функционал:**
- Отображение всех транзакций пользователя
- Фильтрация:
  - По типу (Все/Зачисление/Списание)
  - По дате (от/до)
- Пагинация (50 записей на страницу)
- Форматирование даты
- Отображение суммы с префиксом (+/-)
- Badge для типа транзакции

**UI элементы:**
- Dialog с большой высотой и скроллом
- Таблица транзакций
- Фильтры в виде Select и Input
- Кнопки пагинации
- Badge для типов транзакций

### 7.6 SiteHeader (`components/admin/SiteHeader.tsx`)
**Назначение:** Заголовок админ-панели

**Функционал:**
- Отображение названия текущего раздела
- Кнопка сворачивания Sidebar
- Иконка уведомлений (заглушка)

**UI элементы:**
- Header с border-bottom
- Separator
- Кнопка уведомлений

---

## 8. Базовые UI компоненты (shadcn/ui)

Все базовые компоненты из библиотеки shadcn/ui используются как строительные блоки:

### 8.1 Button (`components/ui/button.tsx`)
- Варианты: default, outline, ghost, destructive, secondary
- Размеры: sm, default, lg, icon
- Состояния: disabled, loading

### 8.2 Card (`components/ui/card.tsx`)
- Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter
- Используется для группировки контента

### 8.3 Dialog (`components/ui/dialog.tsx`)
- Dialog, DialogTrigger, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter
- Модальные окна

### 8.4 Sheet (`components/ui/sheet.tsx`)
- Sheet, SheetTrigger, SheetContent, SheetHeader, SheetTitle, SheetDescription, SheetFooter
- Боковые панели и модальные окна

### 8.5 Input (`components/ui/input.tsx`)
- Текстовые поля ввода
- Поддержка различных типов (text, email, password, number, date)

### 8.6 Select (`components/ui/select.tsx`)
- Выпадающие списки
- SelectTrigger, SelectContent, SelectItem, SelectValue

### 8.7 Textarea (`components/ui/textarea.tsx`)
- Многострочные текстовые поля

### 8.8 Label (`components/ui/label.tsx`)
- Подписи к полям формы

### 8.9 Badge (`components/ui/badge.tsx`)
- Варианты: default, secondary, destructive, outline
- Используется для категорий, статусов, тегов

### 8.10 Avatar (`components/ui/avatar.tsx`)
- Avatar, AvatarImage, AvatarFallback
- Отображение аватаров пользователей

### 8.11 Table (`components/ui/table.tsx`)
- Table, TableHeader, TableBody, TableRow, TableHead, TableCell
- Таблицы данных

### 8.12 Progress (`components/ui/progress.tsx`)
- Линейный индикатор прогресса (0-100%)

### 8.13 Skeleton (`components/ui/skeleton.tsx`)
- Плейсхолдеры для контента во время загрузки

### 8.14 Tabs (`components/ui/tabs.tsx`)
- Вкладки для организации контента

### 8.15 Tooltip (`components/ui/tooltip.tsx`)
- Всплывающие подсказки

### 8.16 DropdownMenu (`components/ui/dropdown-menu.tsx`)
- Выпадающие меню
- DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator

### 8.17 Separator (`components/ui/separator.tsx`)
- Разделители контента (вертикальные/горизонтальные)

### 8.18 Switch (`components/ui/switch.tsx`)
- Переключатели on/off

### 8.19 Sidebar (`components/ui/sidebar.tsx`)
- Боковая панель навигации
- SidebarHeader, SidebarContent, SidebarFooter, SidebarMenu, SidebarMenuItem, SidebarMenuButton

### 8.20 FileUpload (`components/ui/file-upload.tsx`)
- Компонент для загрузки файлов
- GridPattern для фонового паттерна

### 8.21 Sonner (`components/ui/sonner.tsx`)
- Toast уведомления
- Используется через `toast.success()`, `toast.error()`, `toast.info()`

---

## 9. Служебные компоненты

### 9.1 ErrorBoundary (`components/error-boundary.tsx`)
**Назначение:** Обработка ошибок React компонентов

**Функционал:**
- Перехват ошибок в дочерних компонентах
- Отображение fallback UI при ошибке
- Кнопки для перезагрузки страницы или возврата на главную
- Логирование ошибок в консоль

**UI элементы:**
- Card с сообщением об ошибке
- Иконка AlertTriangle
- Кнопки действий

### 9.2 Sheet (`components/sheet.tsx`)
**Назначение:** Кастомная реализация Sheet компонента

**Функционал:**
- Поддержка всех сторон (top, right, bottom, left)
- Анимации открытия/закрытия
- Overlay с blur эффектом
- Опциональная кнопка закрытия

---

## 10. Интеграции и зависимости

### Контексты:
- `upload-context` — глобальное состояние модального окна загрузки
- `session-provider` — провайдер сессии NextAuth
- `query-provider` — провайдер React Query

### Хуки:
- `useAuth` — проверка авторизации и получение данных пользователя
- `useUpload` — управление состоянием загрузки
- `use-mobile` — определение мобильного устройства

### Store (Zustand):
- `useVideoStore` — состояние видео
- `useGenerationStore` — состояние генерации
- `useChallengeStore` — состояние челленджей

### Queries (React Query):
- `useUploadImage` — мутация загрузки изображения
- `useInitiateGeneration` — мутация запуска генерации
- `useGenerationStatus` — запрос статуса генерации
- `useChallenges` — запрос списка челленджей
- `useVideos` — запрос списка видео

---

## 11. Особенности дизайна

### Цветовая схема:
- Primary: индиго-фиолетовый градиент
- Background: адаптивный к теме (light/dark)
- Muted: приглушенные цвета для второстепенного контента

### Анимации:
- Framer Motion для плавных переходов
- Hover эффекты на интерактивных элементах
- Loading состояния с анимацией

### Адаптивность:
- Mobile-first подход
- Breakpoints: sm, md, lg
- Адаптивные сетки и flex-контейнеры
- Мобильное меню через Sheet

### Типографика:
- Системные шрифты
- Размеры: xs, sm, base, lg, xl, 2xl
- Веса: normal, medium, semibold, bold

### Spacing:
- Tailwind spacing scale
- Консистентные отступы через gap и padding

---

## 12. Рекомендации для дизайна

### Приоритетные компоненты для дизайна:
1. **VideoCard** — основной элемент ленты видео
2. **FileUpload** — ключевой пользовательский поток
3. **Navigation** — навигация должна быть интуитивной
4. **ShareDialog** — важный элемент вирусности
5. **ChallengeCard** — привлечение к челленджам

### Состояния для проработки:
- Loading состояния всех компонентов
- Error состояния с понятными сообщениями
- Empty states (когда нет данных)
- Success состояния с подтверждением действий

### Интерактивность:
- Hover эффекты на всех кликабельных элементах
- Focus состояния для доступности
- Transitions между состояниями
- Feedback при действиях пользователя

---

## Заключение

Данная документация описывает все компоненты проекта Vivio и их функционал. Компоненты организованы по категориям и следуют принципам модульности и переиспользования. Большинство UI компонентов основаны на shadcn/ui, что обеспечивает консистентность дизайна и доступность.

Для дизайна рекомендуется начать с ключевых пользовательских потоков: загрузка и генерация видео, просмотр видео, участие в челленджах. Особое внимание следует уделить состояниям загрузки и обработке ошибок для обеспечения хорошего UX.
