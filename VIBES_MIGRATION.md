# Миграция Challenge → Vibe + Теги и Избранное

## Обзор изменений

Данная миграция переименовывает концепцию "Челленджей" в "Вайбы" и добавляет функционал тегов и избранного.

## Основные изменения

### 1. База данных (Prisma Schema)

**Переименования:**
- `enum ChallengeCategory` → `enum VibeCategory`
- `model Challenge` → `model Vibe`
- `challengeId` → `vibeId` во всех моделях

**Новые модели:**
- `Tag` - теги для вайбов
- `VibeTag` - связь many-to-many между вайбами и тегами
- `FavoriteVibe` - избранные вайбы пользователей

### 2. API Endpoints

**Переименованные:**
- `/api/challenges` → `/api/vibes`
- `/api/challenges/[id]` → `/api/vibes/[id]`
- `/api/admin/challenges` → `/api/admin/vibes`
- `/api/admin/challenges/[id]` → `/api/admin/vibes/[id]`

**Новые:**
- `GET /api/admin/tags` - список тегов
- `POST /api/admin/tags` - создание тега
- `DELETE /api/admin/tags/[id]` - удаление тега
- `POST /api/admin/vibes/[id]/tags` - добавление тега к вайбу
- `DELETE /api/admin/vibes/[id]/tags` - удаление тега у вайба
- `GET /api/favorites` - список избранных вайбов
- `POST /api/favorites/[vibeId]` - добавить в избранное
- `DELETE /api/favorites/[vibeId]` - удалить из избранного

### 3. Страницы

**Переименованные:**
- `/challenges` → `/vibes`
- `/challenges/[id]` → `/vibes/[id]`

**Новые:**
- `/favorites` - страница избранных вайбов

**Обновленные:**
- `/create` - поддержка query параметра `?vibeId=xxx`
- `/videos` - отображение вайбов на карточках с VibeBadge
- `/` (главная) - отображение вайбов вместо челленджей

### 4. Компоненты

**Переименованные:**
- `ChallengeCard` → `VibeCard`
- `useChallengeStore` → `useVibeStore`

**Новые:**
- `VibeBadge` - компонент для отображения вайба с:
  - Иконкой избранного (Heart)
  - Названием вайба
  - Тегами
  - Кнопкой "Создать" (переход на `/create?vibeId=xxx`)
- `TagsManager` - админ-компонент для управления тегами

**Обновленные:**
- VideoCard теперь используется совместно с VibeBadge для отображения вайба

### 5. Навигация

**Изменения:**
- "Тренды" → "Вайбы" (href: `/vibes`)
- Добавлен пункт "Избранное" с иконкой Heart (href: `/favorites`)

### 6. Админ-панель

**Изменения:**
- Раздел "Челленджи" → "Вайбы"
- Добавлен раздел "Теги" с полным управлением
- Вайбы теперь отображают прикрепленные теги
- Возможность привязки тегов к вайбам (в будущих обновлениях)

## Функционал

### Теги

- Администраторы могут создавать и удалять теги
- Теги можно привязывать к вайбам
- Теги отображаются на карточках вайбов
- Теги помогают категоризировать вайбы

### Избранное

- Пользователи могут добавлять вайбы в избранное
- Иконка сердца на VibeBadge для быстрого добавления/удаления
- Страница `/favorites` со всеми избранными вайбами
- Быстрый доступ к избранному через навигацию

### Быстрое создание

- На каждой карточке видео есть кнопка "Создать" в VibeBadge
- При клике переход на `/create?vibeId=xxx` с предустановленным вайбом
- Упрощает создание видео в том же стиле

## Миграция данных

**ВАЖНО:** При выполнении миграции все существующие данные были сброшены.

Для наполнения БД вайбами используйте:

```bash
npx tsx prisma/seed.ts
```

Или создайте вайбы через админ-панель вручную.

## Кеширование

Обновлены Redis ключи кеша:
- `challenges:list` → `vibes:list` (старые ключи также поддерживаются для совместимости)

## Backwards Compatibility

Старые API endpoints `/api/challenges` удалены. Все запросы должны использовать `/api/vibes`.

## Проверка работоспособности

После миграции проверьте:

1. ✅ Страница вайбов `/vibes` отображается
2. ✅ Создание видео с вайбом работает
3. ✅ Добавление в избранное работает
4. ✅ Страница избранного `/favorites` доступна
5. ✅ Админка: управление вайбами работает
6. ✅ Админка: управление тегами работает
7. ✅ Быстрое создание с вайба работает (кнопка на VibeBadge)

## Следующие шаги

1. Добавить UI для привязки тегов к вайбам в админке (в форме создания/редактирования вайба)
2. Добавить фильтрацию вайбов по тегам на странице `/vibes`
3. Рассмотреть добавление поиска вайбов по тегам
